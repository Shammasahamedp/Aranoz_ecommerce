<%- include('../partials/header.ejs') %>
<title>Password Reset</title>
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

<style>
    body {
        background-color: #f8f9fa;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }
    .login-container {
        background-color: #fc77b1;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(250, 244, 244, 0.1);
        max-width: 400px;
        width: 100%;
        color: azure;
        text-align: center; 
    }
    .login-container h2 {
        margin-bottom: 1.5rem;
        font-weight: bold;
    }
    .login-container .form-group {
        margin-bottom: 1.25rem;
    }
    .login-container .btn-primary {
        width: 100%;
    }
</style>

<div class="login-container">
    <h2>Password Reset</h2>
    <form action="/user/resetpassword" method="POST" id="passwordresetform">
        <div class="form-group">
            <label for="password">Enter New Password</label>
            <input type="password" class="form-control" id="password" name="password" placeholder="Enter new password" required>
        </div>
        <div class="form-group">
            <label for="passwordconfirm">Confirm Password</label>
            <input type="password" class="form-control" id="passwordconfirm" name="passwordconfirm" placeholder="Confirm password" required>
        </div>
        <div class="text-danger" style="display: none;" id="validate">password is not match</div>
        <button type="submit" class="btn btn-primary">Change Password</button>
    </form>
</div>
<script>
    document.addEventListener('DOMContentLoaded',async()=>{
        const urlParams = new URLSearchParams(window.location.search);
const token = urlParams.get('token');
        const form=document.getElementById('passwordresetform')
        form.addEventListener('submit',async(event)=>{
            event.preventDefault()
            const firstPassword=document.getElementById('password').value.trim()
            const confirmpassword=document.getElementById('passwordconfirm').value.trim()
            const validationText=document.getElementById('validate')
            if(firstPassword!==confirmpassword){
                validationText.style.display='inline'
                return 
            }else{
                validationText.style.display='none'
            }
            const response= await fetch(`/user/resetpassword?token=${token}`,{
                method:'POST',
                headers:{
                    'Content-Type':'application/json'
                },
                body:JSON.stringify({confirmpassword})
            })
            try{
                if(response.ok){
                const result=await response.json()
                Swal.fire({
                    title:'success',
                    text:result.message,
                    icon:'success',
                    confirButtonText:'OK'
                }).then(()=>{
                    window.location.href='/user/login'
                })
            }else{
                throw new Error('error occured in reset password')
            }
            }catch(err){
                const result=await response.json()
                console.error(err)
                Swal.fire({
                    title:'failed',
                    text:result.message,
                    icon:'error',
                    confirButtonText:'OK'
                })
            }
        })
    })
</script>
<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>


<%- include('../partials/footer.ejs') %>
