<% include ('../usersidepartials/header')%>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/themify-icons/0.1.2/css/themify-icons.min.css" -->
        
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <!-- <link rel="icon" href="img/favicon.png"> -->
    <link rel="stylesheet" href="/img/favicon.png">
    <!-- Bootstrap CSS -->
    <!-- <link rel="stylesheet" href="css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="/css/usercss/bootstrap.min.css">
    <!-- animate CSS -->
    <!-- <link rel="stylesheet" href="css/animate.css"> -->
    <link rel="stylesheet" href="/css/usercss/animate.css">
    <!-- owl carousel CSS -->
    <!-- <link rel="stylesheet" href="css/owl.carousel.min.css"> -->
    <link rel="stylesheet" href="/css/usercss/owl.carousel.min.css">
    <!-- <link rel="stylesheet" href="css/lightslider.min.css"> -->
    <link rel="stylesheet" href="/css/usercss/lightslider.min.css">
    <!-- font awesome CSS -->
    <!-- <link rel="stylesheet" href="css/all.css"> -->
    <link rel="stylesheet" href="/css/usercss/all.css">
    <!-- flaticon CSS -->
    <!-- <link rel="stylesheet" href="css/flaticon.css"> -->
    <link rel="stylesheet" href="/css/usercss/flaticon.css">
    <!-- <link rel="stylesheet" href="css/themify-icons.css"> -->
    <link rel="stylesheet" href="/css/usercss/themify-icons.css">
    <!-- font awesome CSS -->
    <!-- <link rel="stylesheet" href="css/magnific-popup.css"> -->
    <link rel="stylesheet" href="/css/usercss/magnific-popup.css">
    <!-- style CSS -->
    <!-- <link rel="stylesheet" href="css/style.css"> -->
    <link rel="stylesheet" href="/css/usercss/style.css">

    <title>aranoz|profile</title>


    <!--::header part start::-->
    <header class="main_menu home_menu">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-12">
                    <nav class="navbar navbar-expand-lg navbar-light">
                        <a class="navbar-brand" href="index.html"> <img src="/img/logo.png" alt="logo"> </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="menu_icon"><i class="fas fa-bars"></i></span>
                        </button>

                        <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent">
                            <ul class="navbar-nav">
                                <!-- <li class="nav-item">
                                        <a class="nav-link" href="/home">Home</a>
                                    </li> -->
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="blog.html" id="navbarDropdown_1"
                                        role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Shop
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdown_1">
                                        <a class="dropdown-item" href="category.html"> shop category</a>
                                        <a class="dropdown-item" href="single-product.html">product details</a>

                                    </div>
                                </li>

                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="blog.html" id="navbarDropdown_3"
                                        role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Profile
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdown_2">
                                        <!-- <a class="dropdown-item" href="/user/dashboard/profile"> Profile</a> -->
                                        <a class="dropdown-item" href="/user/dashboard/profile/address">Address</a>
                                        <a class="dropdown-item" href="/user/dashboard/profile/wishlist">Wishlist </a>
                                        <a class="dropdown-item" href="/user/dashboard/profile/wallet">Wallet</a>
                                        <a class="dropdown-item" href="/user/dashboard/profile/orders">Orders</a>
                                        <a class="dropdown-item" onclick="logout()">Logout</a>

                                    </div>
                                </li>

                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="blog.html" id="navbarDropdown_2"
                                        role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        blog
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdown_2">
                                        <a class="dropdown-item" href="blog.html"> blog</a>
                                        <a class="dropdown-item" href="single-blog.html">Single blog</a>
                                    </div>
                                </li>

                                <li class="nav-item">
                                    <a class="nav-link" href="/contact">Contact</a>
                                </li>
                            </ul>
                        </div>
                        <div class="hearer_icon d-flex">
                            <a id="search_1" href="javascript:void(0)"><i class="bi bi-search"></i></a>
                            <a href="/user/cart"><i class="bi bi-cart"></i></a>
                            <div class="dropdown cart">
                                <a class="dropdown-toggle" href="#" id="navbarDropdown3" role="button"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="bi bi-heart"></i>
                                </a>
                                <!-- <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <div class="single_product">

                                </div>
                            </div> -->

                            </div>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
        <div class="search_input" id="search_input_box">
            <div class="container ">
                <form class="d-flex justify-content-between search-inner">
                    <input type="text" class="form-control" id="search_input" placeholder="Search Here">
                    <button type="submit" class="btn"></button>
                    <span class="ti-close" id="close_search" title="Close Search"></span>
                </form>
            </div>
        </div>
    </header>
    <!-- Header part end-->

    <!-- breadcrumb start-->
    <!-- <section class="breadcrumb breadcrumb_bg">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="breadcrumb_iner">
                        <div class="breadcrumb_iner_item">
                            <h2>User Profile</h2>
                            <p>Home <span>-</span> Tracking Order</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section> -->
    <section class="breadcrumb breadcrumb_bg">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-lg-8">
              <div class="breadcrumb_iner">
                <div class="breadcrumb_iner_item">
                  <h2>User profile</h2>
                  <h1></h1>
                  <p>
                    <% breadcrumbItems.forEach(function(item, index) { %>
                      <% if (item.url) { %>
                        <a href="<%= item.url %>">
                          <%= item.name %>
                        </a>
                        <% } else { %>
                          <%= item.name %>
                            <% } %>
                              <% if (index < breadcrumbItems.length - 1) { %>
                                <span> - </span>
                                <% } %>
                                  <% }) %>
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    <!-- breadcrumb start-->
    <section class="tracking_box_area padding_top">
        <div class="container">
            <div class="row align-items-center">
                <!-- <div class="col-lg-6">
                      <div class="reacking_box_text text-center h-100">
                        <h2>New to our Shop?</h2>
                        <p>There are advances being made in science and technology
                          everyday, and a good example of this is the</p>
                          <a href="#" class="btn_2">Create an Account</a>
                      </div>
                    </div> -->
                <div class="col-lg-12">

                    <div class="tracking_box_inner">
                        <!-- <p>To track your order please enter your Order ID in the box below and press the "Track" button. This was
                      given
                      to you on your receipt and in the confirmation email you should have received.</p> -->
                        <form class="row tracking_form" method="post" action="/user/dashboard/profile/edit" id="editProfileForm">
                            <div class="col-md-12 form-group">
                                <label for="name">
                                    <h4>name</h4>
                                </label>
                                <p></p>
                                <input type="text" class="form-control custom-input" id="name" name="name"
                                    value="<%=profileDetails.name%>" required>
                            </div>
                            <div class="text-danger" id="validatename" style="display: none;">name is not valid</div>
                            <div class="col-md-12 form-group">
                                <label for="email">
                                    <h4>email</h4>
                                </label>
                                <input type="email" class="form-control" id="email" name="email"
                                    value="<%=profileDetails.email%>" disabled>
                            </div>
                            <div class="col-md-12 form-group">
                                <label for="phonenumber">
                                    <h4>phonenumber</h4>
                                </label>
                                <input type="tel" class="form-control" id="phonenumber" name="phonenumber"
                                    placeholder="" value="<%=profileDetails.phone%>">
                            </div>
                            <div class="text-danger" id="validatenumber" style="display: none;">number is not valid
                            </div>
                            <div class="col-md-12 form-group">
                                <label for="email">
                                    <h4>join date</h4>
                                </label>
                                <input type="email" class="form-control" id="joindate" name="joindate" placeholder=""
                                    value="<%=profileDetails.createdAt%>" disabled>
                            </div>
                            <div class="col-md-12 form-group">
                                <button type="submit" value="submit" class="btn_3">Edit profile</button>
                            </div>
                            <div id="formvalidate" style="display: none; " class="text-danger">cannot submit without any
                                change</div>
                        </form>
                    </div>
                </div>
                <script>

                </script>

            </div>

        </div>
    </section>

    <footer class="footer_part">
        <div class="container">
            <div class="row justify-content-around">
                <div class="col-sm-6 col-lg-2">
                    <div class="single_footer_part">
                        <h4>Top Products</h4>
                        <ul class="list-unstyled">
                            <li><a href="">Managed Website</a></li>
                            <li><a href="">Manage Reputation</a></li>
                            <li><a href="">Power Tools</a></li>
                            <li><a href="">Marketing Service</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-2">
                    <div class="single_footer_part">
                        <h4>Quick Links</h4>
                        <ul class="list-unstyled">
                            <li><a href="">Jobs</a></li>
                            <li><a href="">Brand Assets</a></li>
                            <li><a href="">Investor Relations</a></li>
                            <li><a href="">Terms of Service</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-2">
                    <div class="single_footer_part">
                        <h4>Features</h4>
                        <ul class="list-unstyled">
                            <li><a href="">Jobs</a></li>
                            <li><a href="">Brand Assets</a></li>
                            <li><a href="">Investor Relations</a></li>
                            <li><a href="">Terms of Service</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-2">
                    <div class="single_footer_part">
                        <h4>Resources</h4>
                        <ul class="list-unstyled">
                            <li><a href="">Guides</a></li>
                            <li><a href="">Research</a></li>
                            <li><a href="">Experts</a></li>
                            <li><a href="">Agencies</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-4">
                    <div class="single_footer_part">
                        <h4>Newsletter</h4>
                        <p>Heaven fruitful doesn't over lesser in days. Appear creeping
                        </p>
                        <div id="mc_embed_signup">
                            <form target="_blank"
                                action="https://spondonit.us12.list-manage.com/subscribe/post?u=1462626880ade1ac87bd9c93a&amp;id=92a4423d01"
                                method="get" class="subscribe_form relative mail_part">
                                <input type="email" name="email" id="newsletter-form-email" placeholder="Email Address"
                                    class="placeholder hide-on-focus" onfocus="this.placeholder = ''"
                                    onblur="this.placeholder = ' Email Address '">
                                <button type="submit" name="submit" id="newsletter-submit"
                                    class="email_icon newsletter-submit button-contactForm">subscribe</button>
                                <div class="mt-10 info"></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="copyright_part">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="copyright_text">
                            <P><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                                Copyright &copy;
                                <script>document.write(new Date().getFullYear());</script> All rights reserved |
                                This template is made with <i class="ti-heart" aria-hidden="true"></i> by <a
                                    href="https://colorlib.com" target="_blank">Colorlib</a>
                                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                            </P>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="footer_icon social_icon">
                            <ul class="list-unstyled">
                                <li><a href="#" class="single_social_icon"><i class="fab fa-facebook-f"></i></a>
                                </li>
                                <li><a href="#" class="single_social_icon"><i class="fab fa-twitter"></i></a></li>
                                <li><a href="#" class="single_social_icon"><i class="fas fa-globe"></i></a></li>
                                <li><a href="#" class="single_social_icon"><i class="fab fa-behance"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!--::footer_part end::-->

    <script>
         document.addEventListener('DOMContentLoaded', async () => {
            const form = document.getElementById('editProfileForm')
            console.log(form)
            const oldNameElement = document.getElementById('name')
            console.log(oldNameElement)
            const oldName = oldNameElement.value.trim()
            const oldPhoneElement = document.getElementById('phonenumber')
            const oldPhone= oldPhoneElement.value.trim()
            // console.log(oldPhone)
            const formvalidate = document.getElementById('formvalidate')
            form.addEventListener('submit', async (event) => {
                console.log('before prevent default')
                event.preventDefault()
                console.log('after prevent default')

                const name = document.getElementById('name').value.trim()
                const phonenumber = document.getElementById('phonenumber').value.trim()
                const validateNumberMsg = document.getElementById('validatenumber')
                const validateNameMsg = document.getElementById('validatename')
                const validateName = /^(?=.*\S)(?=\D*$).*$/.test(name)
                const validPhone = /^[1-9]\d{9}$/.test(phonenumber)
                if (!validateName) {
                    validateNameMsg.style.display = 'inline'
                    return
                } else {
                    validateNameMsg.style.display = 'none'

                }
                if (!validPhone && phonenumber !== '') {
                    validateNumberMsg.style.display = 'inline'
                    return
                } else {
                    validateNumberMsg.style.display = 'none'

                } if (oldName === name && oldPhone === phonenumber) {
                    formvalidate.style.display = 'inline'
                    return
                } else {
                    formvalidate.style.display = 'none'
                }
                console.log('button clicked')
                console.log(name)
                console.log(phonenumber)

                try {
                    const data = {
                        name, phonenumber
                    }
                    const response = await fetch('/user/dashboard/profile/edit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    })
                    const result = await response.json()
                    if (response.ok) {

                        Swal.fire({
                            title: 'success',
                            text: result.message,
                            icon: 'success',
                            confirmButtonText: 'OK'
                        })
                    } else {

                        Swal.fire({
                            titile: 'failed',
                            text: result.message,
                            icon: 'error',
                            confirmTextButton: 'OK'
                        })
                    }
                } catch (err) {
                    console.error(err)

                }
            })
        })
        async function logout() {

            try {
                const response = await fetch('/user/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                const data = await response.json()

                if (response.ok) {
                    Swal.fire({
                        title: 'success',
                        text: data.message,
                        icon: 'success',
                        confirmButtonText: 'OK'
                    }).then(() => {
                        window.location.href = '/'
                    })
                } else {
                    Swal.fire({
                        title: 'failed',
                        text: data.message,
                        icon: 'failed',
                        confirmButtonText: 'OK'
                    })
                }
            } catch (err) {
                console.log('error in logout')
                Swal.fire({
                    title: 'failed',
                    text: 'error in logout',
                    icon: 'failed',
                    confirmButtonText: 'OK'
                })
            }
        }
       
    </script>

    <!-- jquery plugins here-->
    <!-- jquery -->
    <!-- <script src="/js/jquery-1.12.1.min.js"></script> -->
    <script src="/js/jquery-1.12.1.min.js"></script>
    <!-- popper js -->
    <!-- <script src="js/popper.min.js"></script> -->
    <script src="/js/popper.min.js"></script>
    <!-- bootstrap js -->
    <!-- <script src="js/bootstrap.min.js"></script> -->
    <script src="/js/bootstrap.min.js"></script>
    <!-- easing js -->
    <!-- <script src="js/jquery.magnific-popup.js"></script> -->
    <script src="/js/jquery.magnific-popup.js"></script>
    <!-- swiper js -->
    <!-- <script src="js/lightslider.min.js"></script> -->
    <script src="/js/lightslider.min.js"></script>
    <!-- swiper js -->
    <!-- <script src="js/masonry.pkgd.js"></script> -->
    <script src="/js/masonry.pkgd.js"></script>
    <!-- particles js -->
    <!-- <script src="js/owl.carousel.min.js"></script> -->
    <script src="/js/owl.carousel.min.js"></script>
    <!-- <script src="js/jquery.nice-select.min.js"></script> -->
    <script src="/js/jquery.nice-select.min.js"></script>
    <!-- slick js -->
    <!-- <script src="js/slick.min.js"></script> -->
    <script src="/js/slick.min.js"></script>
    <!-- <script src="js/swiper.jquery.js"></script> -->
    <script src="/js/swiper.jquery.js"></script>
    <!-- <script src="js/jquery.counterup.min.js"></script> -->
    <script src="/js/jquery.counterup.min.js"></script>
    <!-- <script src="js/waypoints.min.js"></script> -->
    <script src="/js/waypoints.min.js"></script>
    <!-- <script src="js/contact.js"></script> -->
    <script src="/js/contact.js"></script>
    <!-- <script src="js/jquery.ajaxchimp.min.js"></script> -->
    <script src="/js/jquery.ajaxchimp.min.js"></script>
    <!-- <script src="js/jquery.form.js"></script> -->
    <script src="/js/jquery.form.js"></script>
    <!-- <script src="js/jquery.validate.min.js"></script> -->
    <script src="/js/jquery.validate.min.js"></script>
    <!-- <script src="js/mail-script.js"></script> -->
    <script src="/js/mail-script.js"></script>
    <!-- <script src="js/stellar.js"></script> -->
    <script src="/js/stellar.js"></script>
    <!-- custom js -->
    <!-- <script src="js/theme.js"></script> -->
    <script src="/js/theme.js"></script>
    <!-- <script src="js/custom.js"></script> -->
    <script src="/js/custom.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>


    <% include ('../usersidepartials/footer')%>